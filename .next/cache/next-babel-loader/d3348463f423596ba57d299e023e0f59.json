{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n//@ts-nocheck\n// vendors\nimport React, { useState, useImperativeHandle, useEffect, useRef, forwardRef, useCallback, useMemo } from 'react';\nimport { Picker } from 'emoji-mart';\nimport t from 'prop-types';\nimport LazyLoad from 'react-lazy-load'; // utils\n\nimport useDebounce from './use-debounce';\n\nfunction InputEmoji(_ref, ref) {\n  _s();\n\n  var value = _ref.value,\n      onChange = _ref.onChange,\n      cleanOnEnter = _ref.cleanOnEnter,\n      onEnter = _ref.onEnter,\n      placeholder = _ref.placeholder,\n      onResize = _ref.onResize,\n      onClick = _ref.onClick,\n      onFocus = _ref.onFocus,\n      maxLength = _ref.maxLength,\n      keepOpenend = _ref.keepOpenend,\n      onKeyDown = _ref.onKeyDown,\n      inputClass = _ref.inputClass,\n      disableRecent = _ref.disableRecent,\n      tabIndex = _ref.tabIndex,\n      borderRadius = _ref.borderRadius,\n      borderColor = _ref.borderColor,\n      fontSize = _ref.fontSize,\n      fontFamily = _ref.fontFamily;\n\n  var _useState = useState(false),\n      showPicker = _useState[0],\n      setShowPicker = _useState[1];\n\n  var _useState2 = useState({}),\n      allEmojiStyle = _useState2[0],\n      setAllEmojiStyle = _useState2[1];\n\n  var _useState3 = useState(null),\n      currentSize = _useState3[0],\n      setCurrentSize = _useState3[1];\n\n  var textInputRef = useRef(null);\n  var cleanedTextRef = useRef('');\n  var placeholderRef = useRef(null);\n  useImperativeHandle(ref, function () {\n    return {\n      get value() {\n        return cleanedTextRef.current;\n      },\n\n      set value(value) {\n        setValue(value);\n      },\n\n      focus: function focus() {\n        textInputRef.current.focus();\n      },\n      blur: function blur() {\n        replaceAllTextEmojiToString();\n      }\n    };\n  });\n  var replaceAllTextEmojis = useCallback(function (text) {\n    var allEmojis = getAllEmojisFromText(text);\n\n    if (allEmojis) {\n      allEmojis = _toConsumableArray(new Set(allEmojis)); // remove duplicates\n\n      allEmojis.forEach(function (emoji) {\n        var style = allEmojiStyle[emoji];\n        if (!style) return;\n        text = replaceAll(text, emoji, \"<img style=\\\"\".concat(style, \"\\\" data-emoji=\\\"\").concat(emoji, \"\\\" src=\\\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\\\" />\"));\n      });\n    }\n\n    return text;\n  }, [allEmojiStyle]);\n  var updateHTML = useCallback(function (nextValue) {\n    nextValue = nextValue || value;\n    textInputRef.current.innerHTML = replaceAllTextEmojis(nextValue || '');\n  }, [replaceAllTextEmojis]);\n  var checkAndEmitResize = useCallback(function () {\n    var nextSize = {\n      width: textInputRef.current.offsetWidth,\n      height: textInputRef.current.offsetHeight\n    };\n\n    if (!currentSize || currentSize.width !== nextSize.width || currentSize.height !== nextSize.height) {\n      onResize(nextSize);\n      setCurrentSize(nextSize);\n    }\n  }, [currentSize, onResize]);\n  var emitChange = useCallback(function () {\n    if (typeof onChange === 'function') {\n      onChange(cleanedTextRef.current);\n    }\n\n    if (typeof onResize === 'function') {\n      checkAndEmitResize();\n    }\n  }, [checkAndEmitResize, onChange, onResize]);\n  useEffect(function () {\n    function handleCopy(e) {\n      var selectedText = window.getSelection();\n      var container = document.createElement('div');\n\n      for (var i = 0, len = selectedText.rangeCount; i < len; ++i) {\n        container.appendChild(selectedText.getRangeAt(i).cloneContents());\n      }\n\n      container = replaceEmojiToString(container);\n      e.clipboardData.setData('text', container.innerText);\n      e.preventDefault();\n\n      function replaceEmojiToString(container) {\n        var images = Array.prototype.slice.call(container.querySelectorAll('img'));\n        images.forEach(function (image) {\n          image.outerHTML = image.dataset.emoji;\n        });\n        return container;\n      }\n    }\n\n    function handlePaste(e) {\n      e.preventDefault();\n      var content;\n\n      if (window.clipboardData) {\n        content = window.clipboardData.getData('Text');\n        content = replaceAllTextEmojis(content);\n\n        if (window.getSelection) {\n          var selObj = window.getSelection();\n          var selRange = selObj.getRangeAt(0);\n          selRange.deleteContents();\n          selRange.insertNode(document.createTextNode(content));\n        }\n      } else if (e.clipboardData) {\n        content = e.clipboardData.getData('text/plain');\n        content = replaceAllTextEmojis(content);\n        document.execCommand('insertHTML', false, content);\n      }\n    }\n\n    var inputEl = textInputRef.current;\n\n    var handleContentEditableInputCopyAndPaste = function handleContentEditableInputCopyAndPaste() {\n      inputEl.addEventListener('copy', handleCopy);\n      inputEl.addEventListener('paste', handlePaste);\n    };\n\n    handleContentEditableInputCopyAndPaste();\n    return function () {\n      inputEl.removeEventListener('copy', handleCopy);\n      inputEl.removeEventListener('paste', handlePaste);\n    };\n  }, [replaceAllTextEmojis]);\n  useEffect(function () {\n    var allEmojiButton = Array.prototype.slice.call(document.querySelectorAll('.emoji-mart-category-list > li > button'));\n    var allEmojiStyle = {};\n    allEmojiButton.forEach(function (emojiButton) {\n      var label = emojiButton.getAttribute('aria-label');\n\n      var _label$split = label.split(','),\n          _label$split2 = _slicedToArray(_label$split, 1),\n          emoji = _label$split2[0];\n\n      var emojiSpanEl = emojiButton.querySelector('span');\n      var style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n      allEmojiStyle[emoji] = style;\n    });\n    setAllEmojiStyle(allEmojiStyle);\n  }, []);\n  useEffect(function () {\n    updateHTML();\n  }, [updateHTML]);\n  var replaceAllTextEmojiToString = useCallback(function () {\n    if (!textInputRef.current) {\n      cleanedTextRef.current = '';\n    }\n\n    var container = document.createElement('div');\n    container.innerHTML = textInputRef.current.innerHTML;\n    var images = Array.prototype.slice.call(container.querySelectorAll('img'));\n    images.forEach(function (image) {\n      image.outerHTML = image.dataset.emoji;\n    });\n    var text = container.innerText; // remove all ↵ for safari\n\n    text = text.replace(/\\n/gi, '');\n    cleanedTextRef.current = text;\n    checkPlaceholder();\n    emitChange();\n  }, [emitChange]);\n\n  var _useDebounce = useDebounce(replaceAllTextEmojiToString, 500),\n      _useDebounce2 = _slicedToArray(_useDebounce, 1),\n      replaceAllTextEmojiToStringDebounced = _useDebounce2[0];\n\n  useEffect(function () {\n    function handleKeydown(event) {\n      placeholderRef.current.style.opacity = 0;\n\n      if (typeof maxLength !== 'undefined' && event.keyCode !== 8 && totalCharacters() >= maxLength) {\n        event.preventDefault();\n      }\n\n      if (event.keyCode === 13) {\n        event.preventDefault();\n        replaceAllTextEmojiToString();\n        var cleanedText = cleanedTextRef.current;\n\n        if (typeof onEnter === 'function') {\n          onEnter(cleanedText);\n        }\n\n        if (cleanOnEnter) {\n          updateHTML('');\n        }\n\n        if (typeof onKeyDown === 'function') {\n          onKeyDown(event);\n        }\n\n        return false;\n      }\n\n      if (typeof onKeyDown === 'function') {\n        onKeyDown(event);\n      }\n    }\n\n    function handleKeyup() {\n      replaceAllTextEmojiToStringDebounced();\n    }\n\n    var inputEl = textInputRef.current;\n    inputEl.addEventListener('keydown', handleKeydown);\n    inputEl.addEventListener('keyup', handleKeyup);\n    return function () {\n      inputEl.removeEventListener('keydown', handleKeydown);\n      inputEl.removeEventListener('keyup', handleKeyup);\n    };\n  }, [onChange, cleanOnEnter, onEnter, updateHTML, replaceAllTextEmojiToString, replaceAllTextEmojiToStringDebounced, emitChange, maxLength, onKeyDown]);\n  useEffect(function () {\n    function handleFocus() {\n      if (typeof onFocus === 'function') {\n        onFocus();\n      }\n    }\n\n    var inputEl = textInputRef.current;\n    inputEl.addEventListener('focus', handleFocus);\n    return function () {\n      inputEl.removeEventListener('focus', handleFocus);\n    };\n  }, [onFocus]);\n\n  function totalCharacters() {\n    var text = textInputRef.current.innerText;\n    var html = textInputRef.current.innerHTML;\n    var textCount = text.length;\n    var emojisCount = (html.match(/<img/g) || []).length;\n    return textCount + emojisCount;\n  }\n\n  useEffect(function () {\n    if (textInputRef.current) {\n      setCurrentSize({\n        width: textInputRef.current.offsetWidth,\n        height: textInputRef.current.offsetHeight\n      });\n    }\n  }, []);\n  var excluePicker = useMemo(function () {\n    var exclude = [];\n\n    if (disableRecent) {\n      exclude.push('recent');\n    }\n\n    return exclude;\n  }, [disableRecent]);\n\n  function setValue(value) {\n    updateHTML(value);\n    textInputRef.current.blur();\n  }\n\n  function toggleShowPicker() {\n    setShowPicker(function (showPicker) {\n      return !showPicker;\n    });\n  }\n\n  function pasteHtmlAtCaret(html) {\n    var sel, range;\n\n    if (window.getSelection) {\n      // IE9 and non-IE\n      sel = window.getSelection();\n\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents(); // Range.createContextualFragment() would be useful here but is\n        // non-standard and not supported in all browsers (IE9, for one)\n\n        var el = document.createElement('div');\n        el.innerHTML = html;\n        var frag = document.createDocumentFragment();\n        var node;\n        var lastNode;\n\n        while (node = el.firstChild) {\n          lastNode = frag.appendChild(node);\n        }\n\n        range.insertNode(frag); // Preserve the selection\n\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    } else if (document.selection && document.selection.type !== 'Control') {\n      // IE < 9\n      document.selection.createRange().pasteHTML(html);\n    }\n  }\n\n  function replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n  }\n\n  function getImage(emoji) {\n    var shortNames = \"\".concat(emoji.short_names);\n    shortNames = replaceAll(shortNames, ',', ', ');\n    var emojiSpanEl = document.querySelector(\"[aria-label=\\\"\".concat(emoji[\"native\"], \", \").concat(shortNames, \"\\\"] > span\"));\n    if (!emojiSpanEl) return '';\n    var style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n    return \"<img style=\\\"\".concat(style, \"\\\" data-emoji=\\\"\").concat(emoji[\"native\"], \"\\\" src=\\\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\\\" />\");\n  }\n\n  function handleSelectEmoji(emoji) {\n    placeholderRef.current.style.opacity = 0;\n    textInputRef.current.focus();\n    pasteHtmlAtCaret(getImage(emoji));\n    textInputRef.current.focus();\n    emitChange();\n\n    if (!keepOpenend) {\n      toggleShowPicker();\n    }\n  }\n\n  function getAllEmojisFromText(text) {\n    return text.match(/(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?)*/g);\n  }\n\n  function checkPlaceholder() {\n    var text = cleanedTextRef.current;\n\n    if (text !== '' && placeholderRef.current.opacity !== 0) {\n      placeholderRef.current.style.opacity = 0;\n    } else {\n      placeholderRef.current.style.opacity = 1;\n    }\n  }\n\n  function handleClick() {\n    if (typeof onClick === 'function') {\n      onClick();\n    }\n  }\n\n  return __jsx(\"div\", {\n    className: \"react-emoji\"\n  }, __jsx(\"div\", {\n    className: \"react-emoji-picker--container\"\n  }, __jsx(\"div\", {\n    className: \"react-emoji-picker--wrapper\".concat(showPicker ? ' react-emoji-picker--wrapper__show' : '')\n  }, __jsx(\"div\", {\n    className: \"react-emoji-picker\".concat(showPicker ? ' react-emoji-picker__show' : '')\n  }, __jsx(LazyLoad, null, __jsx(Picker, {\n    showPreview: false,\n    showSkinTones: false,\n    set: \"apple\",\n    onSelect: handleSelectEmoji,\n    exclude: excluePicker\n  }))))), __jsx(\"div\", {\n    className: \"react-input-emoji--container\",\n    style: {\n      borderRadius: borderRadius,\n      borderColor: borderColor,\n      fontSize: fontSize,\n      fontFamily: fontFamily\n    }\n  }, __jsx(\"div\", {\n    className: \"react-input-emoji--wrapper\",\n    onClick: handleClick\n  }, __jsx(\"div\", {\n    ref: placeholderRef,\n    className: \"react-input-emoji--placeholder\"\n  }, placeholder), __jsx(\"div\", {\n    ref: textInputRef,\n    tabIndex: tabIndex,\n    contentEditable: true,\n    className: \"react-input-emoji--input\".concat(inputClass ? \" \".concat(inputClass) : ''),\n    onBlur: emitChange\n  }))), __jsx(\"button\", {\n    className: \"react-input-emoji--button\".concat(showPicker ? ' react-input-emoji--button__show' : ''),\n    onClick: toggleShowPicker\n  }, __jsx(\"img\", {\n    src: \"/icons/smile.svg\",\n    alt: \"smile\",\n    style: {\n      width: '1.5em'\n    }\n  })), showPicker && __jsx(\"div\", {\n    className: \"react-input-emoji--overlay\",\n    onClick: toggleShowPicker\n  }));\n}\n\n_s(InputEmoji, \"lFBeBjis8pB4EPfv/2/qMwPOT4Q=\", false, function () {\n  return [useImperativeHandle, useDebounce];\n});\n\n_c = InputEmoji;\nvar InputEmojiWithRef = forwardRef(InputEmoji);\n_c2 = InputEmojiWithRef;\nInputEmojiWithRef.propTypes = {\n  value: t.string,\n  onChange: t.func,\n  cleanOnEnter: t.bool,\n  onEnter: t.func,\n  placeholder: t.string,\n  onResize: t.func,\n  onClick: t.func,\n  onFocus: t.func,\n  maxLength: t.number,\n  keepOpenend: t.bool,\n  onKeyDown: t.func,\n  inputClass: t.string,\n  disableRecent: t.bool,\n  tabIndex: t.number,\n  // style\n  height: t.number,\n  borderRadius: t.number,\n  borderColor: t.string,\n  fontSize: t.number,\n  fontFamily: t.string\n};\nInputEmojiWithRef.defaultProps = {\n  height: 30,\n  placeholder: 'Type a message',\n  borderRadius: 21,\n  borderColor: '#EAEAEA',\n  fontSize: 15,\n  fontFamily: 'sans-serif',\n  tabIndex: 0\n};\nexport default InputEmojiWithRef;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"InputEmoji\");\n$RefreshReg$(_c2, \"InputEmojiWithRef\");","map":{"version":3,"sources":["/media/robert/DATA/Work/web-project/phuong-nam/src-code/components/EmojiInput/index.tsx"],"names":["React","useState","useImperativeHandle","useEffect","useRef","forwardRef","useCallback","useMemo","Picker","t","LazyLoad","useDebounce","InputEmoji","ref","value","onChange","cleanOnEnter","onEnter","placeholder","onResize","onClick","onFocus","maxLength","keepOpenend","onKeyDown","inputClass","disableRecent","tabIndex","borderRadius","borderColor","fontSize","fontFamily","showPicker","setShowPicker","allEmojiStyle","setAllEmojiStyle","currentSize","setCurrentSize","textInputRef","cleanedTextRef","placeholderRef","current","setValue","focus","blur","replaceAllTextEmojiToString","replaceAllTextEmojis","text","allEmojis","getAllEmojisFromText","Set","forEach","emoji","style","replaceAll","updateHTML","nextValue","innerHTML","checkAndEmitResize","nextSize","width","offsetWidth","height","offsetHeight","emitChange","handleCopy","e","selectedText","window","getSelection","container","document","createElement","i","len","rangeCount","appendChild","getRangeAt","cloneContents","replaceEmojiToString","clipboardData","setData","innerText","preventDefault","images","Array","prototype","slice","call","querySelectorAll","image","outerHTML","dataset","handlePaste","content","getData","selObj","selRange","deleteContents","insertNode","createTextNode","execCommand","inputEl","handleContentEditableInputCopyAndPaste","addEventListener","removeEventListener","allEmojiButton","emojiButton","label","getAttribute","split","emojiSpanEl","querySelector","cssText","replace","checkPlaceholder","replaceAllTextEmojiToStringDebounced","handleKeydown","event","opacity","keyCode","totalCharacters","cleanedText","handleKeyup","handleFocus","html","textCount","length","emojisCount","match","excluePicker","exclude","push","toggleShowPicker","pasteHtmlAtCaret","sel","range","el","frag","createDocumentFragment","node","lastNode","firstChild","cloneRange","setStartAfter","collapse","removeAllRanges","addRange","selection","type","createRange","pasteHTML","str","find","RegExp","getImage","shortNames","short_names","handleSelectEmoji","handleClick","InputEmojiWithRef","propTypes","string","func","bool","number","defaultProps"],"mappings":"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","sourcesContent":["//@ts-nocheck\n// vendors\nimport React, { useState, useImperativeHandle, useEffect, useRef, forwardRef, useCallback, useMemo } from 'react';\nimport { Picker } from 'emoji-mart';\nimport t from 'prop-types';\nimport LazyLoad from 'react-lazy-load';\n// utils\nimport useDebounce from './use-debounce';\n\nfunction InputEmoji(\n  {\n    value,\n    onChange,\n    cleanOnEnter,\n    onEnter,\n    placeholder,\n    onResize,\n    onClick,\n    onFocus,\n    maxLength,\n    keepOpenend,\n    onKeyDown,\n    inputClass,\n    disableRecent,\n    tabIndex,\n    // style\n    // height,\n    borderRadius,\n    borderColor,\n    fontSize,\n    fontFamily,\n  },\n  ref,\n) {\n  const [showPicker, setShowPicker] = useState(false);\n  const [allEmojiStyle, setAllEmojiStyle] = useState({});\n  const [currentSize, setCurrentSize] = useState(null);\n\n  const textInputRef = useRef(null);\n  const cleanedTextRef = useRef('');\n  const placeholderRef = useRef(null);\n\n  useImperativeHandle(ref, () => ({\n    get value() {\n      return cleanedTextRef.current;\n    },\n    set value(value) {\n      setValue(value);\n    },\n    focus: () => {\n      textInputRef.current.focus();\n    },\n    blur: () => {\n      replaceAllTextEmojiToString();\n    },\n  }));\n\n  const replaceAllTextEmojis = useCallback(\n    (text) => {\n      let allEmojis = getAllEmojisFromText(text);\n\n      if (allEmojis) {\n        allEmojis = [...new Set(allEmojis)]; // remove duplicates\n\n        allEmojis.forEach((emoji) => {\n          const style = allEmojiStyle[emoji];\n\n          if (!style) return;\n\n          text = replaceAll(\n            text,\n            emoji,\n            `<img style=\"${style}\" data-emoji=\"${emoji}\" src=\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\" />`,\n          );\n        });\n      }\n\n      return text;\n    },\n    [allEmojiStyle],\n  );\n\n  const updateHTML = useCallback(\n    (nextValue) => {\n      nextValue = nextValue || value;\n      textInputRef.current.innerHTML = replaceAllTextEmojis(nextValue || '');\n    },\n    [replaceAllTextEmojis],\n  );\n\n  const checkAndEmitResize = useCallback(() => {\n    const nextSize = {\n      width: textInputRef.current.offsetWidth,\n      height: textInputRef.current.offsetHeight,\n    };\n\n    if (!currentSize || currentSize.width !== nextSize.width || currentSize.height !== nextSize.height) {\n      onResize(nextSize);\n      setCurrentSize(nextSize);\n    }\n  }, [currentSize, onResize]);\n\n  const emitChange = useCallback(() => {\n    if (typeof onChange === 'function') {\n      onChange(cleanedTextRef.current);\n    }\n\n    if (typeof onResize === 'function') {\n      checkAndEmitResize();\n    }\n  }, [checkAndEmitResize, onChange, onResize]);\n\n  useEffect(() => {\n    function handleCopy(e) {\n      const selectedText = window.getSelection();\n\n      let container = document.createElement('div');\n\n      for (let i = 0, len = selectedText.rangeCount; i < len; ++i) {\n        container.appendChild(selectedText.getRangeAt(i).cloneContents());\n      }\n\n      container = replaceEmojiToString(container);\n\n      e.clipboardData.setData('text', container.innerText);\n      e.preventDefault();\n\n      function replaceEmojiToString(container) {\n        const images = Array.prototype.slice.call(container.querySelectorAll('img'));\n\n        images.forEach((image) => {\n          image.outerHTML = image.dataset.emoji;\n        });\n\n        return container;\n      }\n    }\n\n    function handlePaste(e) {\n      e.preventDefault();\n      let content;\n      if (window.clipboardData) {\n        content = window.clipboardData.getData('Text');\n        content = replaceAllTextEmojis(content);\n        if (window.getSelection) {\n          const selObj = window.getSelection();\n          const selRange = selObj.getRangeAt(0);\n          selRange.deleteContents();\n          selRange.insertNode(document.createTextNode(content));\n        }\n      } else if (e.clipboardData) {\n        content = e.clipboardData.getData('text/plain');\n        content = replaceAllTextEmojis(content);\n        document.execCommand('insertHTML', false, content);\n      }\n    }\n\n    const inputEl = textInputRef.current;\n\n    const handleContentEditableInputCopyAndPaste = () => {\n      inputEl.addEventListener('copy', handleCopy);\n      inputEl.addEventListener('paste', handlePaste);\n    };\n\n    handleContentEditableInputCopyAndPaste();\n\n    return () => {\n      inputEl.removeEventListener('copy', handleCopy);\n      inputEl.removeEventListener('paste', handlePaste);\n    };\n  }, [replaceAllTextEmojis]);\n\n  useEffect(() => {\n    const allEmojiButton = Array.prototype.slice.call(\n      document.querySelectorAll('.emoji-mart-category-list > li > button'),\n    );\n\n    const allEmojiStyle = {};\n\n    allEmojiButton.forEach((emojiButton) => {\n      const label = emojiButton.getAttribute('aria-label');\n      const [emoji] = label.split(',');\n\n      const emojiSpanEl = emojiButton.querySelector('span');\n\n      const style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n\n      allEmojiStyle[emoji] = style;\n    });\n\n    setAllEmojiStyle(allEmojiStyle);\n  }, []);\n\n  useEffect(() => {\n    updateHTML();\n  }, [updateHTML]);\n\n  const replaceAllTextEmojiToString = useCallback(() => {\n    if (!textInputRef.current) {\n      cleanedTextRef.current = '';\n    }\n\n    const container = document.createElement('div');\n    container.innerHTML = textInputRef.current.innerHTML;\n\n    const images = Array.prototype.slice.call(container.querySelectorAll('img'));\n\n    images.forEach((image) => {\n      image.outerHTML = image.dataset.emoji;\n    });\n\n    let text = container.innerText;\n\n    // remove all ↵ for safari\n    text = text.replace(/\\n/gi, '');\n\n    cleanedTextRef.current = text;\n\n    checkPlaceholder();\n\n    emitChange();\n  }, [emitChange]);\n\n  const [replaceAllTextEmojiToStringDebounced] = useDebounce(replaceAllTextEmojiToString, 500);\n\n  useEffect(() => {\n    function handleKeydown(event) {\n      placeholderRef.current.style.opacity = 0;\n\n      if (typeof maxLength !== 'undefined' && event.keyCode !== 8 && totalCharacters() >= maxLength) {\n        event.preventDefault();\n      }\n\n      if (event.keyCode === 13) {\n        event.preventDefault();\n\n        replaceAllTextEmojiToString();\n\n        const cleanedText = cleanedTextRef.current;\n\n        if (typeof onEnter === 'function') {\n          onEnter(cleanedText);\n        }\n\n        if (cleanOnEnter) {\n          updateHTML('');\n        }\n\n        if (typeof onKeyDown === 'function') {\n          onKeyDown(event);\n        }\n\n        return false;\n      }\n\n      if (typeof onKeyDown === 'function') {\n        onKeyDown(event);\n      }\n    }\n\n    function handleKeyup() {\n      replaceAllTextEmojiToStringDebounced();\n    }\n\n    const inputEl = textInputRef.current;\n\n    inputEl.addEventListener('keydown', handleKeydown);\n    inputEl.addEventListener('keyup', handleKeyup);\n\n    return () => {\n      inputEl.removeEventListener('keydown', handleKeydown);\n      inputEl.removeEventListener('keyup', handleKeyup);\n    };\n  }, [\n    onChange,\n    cleanOnEnter,\n    onEnter,\n    updateHTML,\n    replaceAllTextEmojiToString,\n    replaceAllTextEmojiToStringDebounced,\n    emitChange,\n    maxLength,\n    onKeyDown,\n  ]);\n\n  useEffect(() => {\n    function handleFocus() {\n      if (typeof onFocus === 'function') {\n        onFocus();\n      }\n    }\n\n    const inputEl = textInputRef.current;\n\n    inputEl.addEventListener('focus', handleFocus);\n\n    return () => {\n      inputEl.removeEventListener('focus', handleFocus);\n    };\n  }, [onFocus]);\n\n  function totalCharacters() {\n    const text = textInputRef.current.innerText;\n    const html = textInputRef.current.innerHTML;\n\n    const textCount = text.length;\n    const emojisCount = (html.match(/<img/g) || []).length;\n\n    return textCount + emojisCount;\n  }\n\n  useEffect(() => {\n    if (textInputRef.current) {\n      setCurrentSize({\n        width: textInputRef.current.offsetWidth,\n        height: textInputRef.current.offsetHeight,\n      });\n    }\n  }, []);\n\n  const excluePicker = useMemo(() => {\n    const exclude = [];\n\n    if (disableRecent) {\n      exclude.push('recent');\n    }\n\n    return exclude;\n  }, [disableRecent]);\n\n  function setValue(value) {\n    updateHTML(value);\n    textInputRef.current.blur();\n  }\n\n  function toggleShowPicker() {\n    setShowPicker((showPicker) => !showPicker);\n  }\n\n  function pasteHtmlAtCaret(html) {\n    let sel, range;\n    if (window.getSelection) {\n      // IE9 and non-IE\n      sel = window.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents();\n\n        // Range.createContextualFragment() would be useful here but is\n        // non-standard and not supported in all browsers (IE9, for one)\n        const el = document.createElement('div');\n        el.innerHTML = html;\n        const frag = document.createDocumentFragment();\n        let node;\n        let lastNode;\n        while ((node = el.firstChild)) {\n          lastNode = frag.appendChild(node);\n        }\n        range.insertNode(frag);\n\n        // Preserve the selection\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    } else if (document.selection && document.selection.type !== 'Control') {\n      // IE < 9\n      document.selection.createRange().pasteHTML(html);\n    }\n  }\n\n  function replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n  }\n\n  function getImage(emoji) {\n    let shortNames = `${emoji.short_names}`;\n\n    shortNames = replaceAll(shortNames, ',', ', ');\n\n    const emojiSpanEl = document.querySelector(`[aria-label=\"${emoji.native}, ${shortNames}\"] > span`);\n\n    if (!emojiSpanEl) return '';\n\n    const style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n\n    return `<img style=\"${style}\" data-emoji=\"${emoji.native}\" src=\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\" />`;\n  }\n\n  function handleSelectEmoji(emoji) {\n    placeholderRef.current.style.opacity = 0;\n\n    textInputRef.current.focus();\n\n    pasteHtmlAtCaret(getImage(emoji));\n\n    textInputRef.current.focus();\n\n    emitChange();\n\n    if (!keepOpenend) {\n      toggleShowPicker();\n    }\n  }\n\n  function getAllEmojisFromText(text) {\n    return text.match(\n      /(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?)*/g,\n    );\n  }\n\n  function checkPlaceholder() {\n    const text = cleanedTextRef.current;\n\n    if (text !== '' && placeholderRef.current.opacity !== 0) {\n      placeholderRef.current.style.opacity = 0;\n    } else {\n      placeholderRef.current.style.opacity = 1;\n    }\n  }\n\n  function handleClick() {\n    if (typeof onClick === 'function') {\n      onClick();\n    }\n  }\n\n  return (\n    <div className=\"react-emoji\">\n      <div className=\"react-emoji-picker--container\">\n        <div className={`react-emoji-picker--wrapper${showPicker ? ' react-emoji-picker--wrapper__show' : ''}`}>\n          <div className={`react-emoji-picker${showPicker ? ' react-emoji-picker__show' : ''}`}>\n            <LazyLoad>\n              <Picker\n                showPreview={false}\n                showSkinTones={false}\n                set=\"apple\"\n                onSelect={handleSelectEmoji}\n                exclude={excluePicker}\n              />\n            </LazyLoad>\n          </div>\n        </div>\n      </div>\n      <div\n        className=\"react-input-emoji--container\"\n        style={{\n          borderRadius,\n          borderColor,\n          fontSize,\n          fontFamily,\n        }}\n      >\n        <div className=\"react-input-emoji--wrapper\" onClick={handleClick}>\n          <div ref={placeholderRef} className=\"react-input-emoji--placeholder\">\n            {placeholder}\n          </div>\n          <div\n            ref={textInputRef}\n            tabIndex={tabIndex}\n            contentEditable\n            className={`react-input-emoji--input${inputClass ? ` ${inputClass}` : ''}`}\n            onBlur={emitChange}\n          />\n        </div>\n      </div>\n      <button\n        className={`react-input-emoji--button${showPicker ? ' react-input-emoji--button__show' : ''}`}\n        onClick={toggleShowPicker}\n      >\n        <img src=\"/icons/smile.svg\" alt=\"smile\" style={{ width: '1.5em' }} />\n      </button>\n      {showPicker && <div className=\"react-input-emoji--overlay\" onClick={toggleShowPicker} />}\n    </div>\n  );\n}\n\nconst InputEmojiWithRef = forwardRef(InputEmoji);\n\nInputEmojiWithRef.propTypes = {\n  value: t.string,\n  onChange: t.func,\n  cleanOnEnter: t.bool,\n  onEnter: t.func,\n  placeholder: t.string,\n  onResize: t.func,\n  onClick: t.func,\n  onFocus: t.func,\n  maxLength: t.number,\n  keepOpenend: t.bool,\n  onKeyDown: t.func,\n  inputClass: t.string,\n  disableRecent: t.bool,\n  tabIndex: t.number,\n  // style\n  height: t.number,\n  borderRadius: t.number,\n  borderColor: t.string,\n  fontSize: t.number,\n  fontFamily: t.string,\n};\n\nInputEmojiWithRef.defaultProps = {\n  height: 30,\n  placeholder: 'Type a message',\n  borderRadius: 21,\n  borderColor: '#EAEAEA',\n  fontSize: 15,\n  fontFamily: 'sans-serif',\n  tabIndex: 0,\n};\n\nexport default InputEmojiWithRef;\n"]},"metadata":{},"sourceType":"module"}