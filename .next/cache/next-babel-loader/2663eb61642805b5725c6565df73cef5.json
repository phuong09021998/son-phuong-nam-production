{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport { update, generateData, isFormValid } from '../../utils/formAction';\nimport FormField from '../../FormField';\nimport styles from './Login.module.scss';\nimport Button from '@material-ui/core/Button';\nimport { loginUser, loginByGoogle, loginByFacebook } from 'redux/actions/users';\nimport { connect } from 'react-redux';\nimport { useRouter } from 'next/router';\nimport GoogleLogin from 'react-google-login';\nimport { message } from 'antd';\nimport CircularProgress from '@material-ui/core/CircularProgress'; // @ts-ignore\n\nimport FacebookLogin from 'react-facebook-login/dist/facebook-login-render-props';\n\nfunction Login(_ref) {\n  _s();\n\n  var user = _ref.user,\n      loginUser = _ref.loginUser,\n      close = _ref.close,\n      loginByGoogle = _ref.loginByGoogle,\n      loginByGoogleError = _ref.loginByGoogleError,\n      loginUserError = _ref.loginUserError,\n      loginByFacebookError = _ref.loginByFacebookError,\n      loginByFacebook = _ref.loginByFacebook;\n  var router = useRouter();\n\n  var _useState = useState({\n    formError: false,\n    formSuccess: '',\n    formdata: {\n      email: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'email_input',\n          type: 'email',\n          placeholder: 'Email'\n        },\n        validation: {\n          required: true,\n          email: true\n        },\n        valid: false,\n        touched: false,\n        validationMessage: ''\n      },\n      password: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'password_input',\n          type: 'password',\n          placeholder: 'Mật khẩu'\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        touched: false,\n        validationMessage: ''\n      }\n    }\n  }),\n      form = _useState[0],\n      setForm = _useState[1];\n\n  var _useState2 = useState(false),\n      waiting = _useState2[0],\n      setWaiting = _useState2[1];\n\n  var userIcon = function userIcon() {\n    return __jsx(\"img\", {\n      src: \"/icons/user.svg\",\n      alt: \"user\"\n    });\n  };\n\n  var passwordIcon = function passwordIcon() {\n    return __jsx(\"img\", {\n      src: \"/icons/password.svg\",\n      alt: \"password\"\n    });\n  };\n\n  var updateForm = function updateForm(element) {\n    var newFormdata = update(element, form.formdata, 'login');\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      formError: false,\n      formdata: newFormdata\n    }));\n  };\n\n  var submitForm = function submitForm(e) {\n    e.preventDefault();\n    var dataToSubmit = generateData(form.formdata, 'login');\n    var formIsValid = isFormValid(form.formdata, 'login'); // console.log(form.formdata);\n\n    if (formIsValid) {\n      loginUser(dataToSubmit);\n      setWaiting(true);\n    } else {\n      setForm(_objectSpread(_objectSpread({}, form), {}, {\n        formError: true\n      }));\n    }\n  };\n\n  var responseGoogle = function responseGoogle(data) {\n    loginByGoogle({\n      token: data.tokenId,\n      name: data.profileObj.name,\n      thirdPartyAvatar: data.profileObj.imageUrl,\n      email: data.profileObj.email,\n      googleId: data.googleId\n    });\n  };\n\n  var responseFacebook = function responseFacebook(data) {\n    // console.log(data);\n    loginByFacebook({\n      token: data.accessToken,\n      name: data.name,\n      email: data.email,\n      facebookId: data.id,\n      thirdPartyAvatar: data.picture.data.url\n    });\n  };\n\n  var handlePress = function handlePress(event) {\n    var code = event.keyCode || event.which;\n\n    if (code === 13) {\n      //13 is the enter keycode\n      //Do stuff in here\n      submitForm(event);\n    }\n  };\n\n  useEffect(function () {\n    if (user) {\n      if (user.role > 0) {\n        // router.push('/admin');\n        console.log(user);\n        document.cookie = \"spn_auth=\".concat(user.token);\n      } else {\n        close();\n      }\n    }\n  }, [user]);\n  useEffect(function () {\n    if (loginByGoogleError) {\n      message.error(loginByGoogleError);\n    }\n  }, [loginByGoogleError]);\n  useEffect(function () {\n    if (loginByFacebookError) {\n      message.error(loginByFacebookError);\n    }\n  }, [loginByFacebookError]);\n  useEffect(function () {\n    if (loginUserError) {\n      setWaiting(false);\n\n      if (loginUserError.includes('Sai mật khẩu')) {\n        setForm(_objectSpread(_objectSpread({}, form), {}, {\n          formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n            password: _objectSpread(_objectSpread({}, form.formdata.password), {}, {\n              valid: false,\n              validationMessage: 'Sai mật khẩu'\n            })\n          })\n        }));\n      } else if (loginUserError.includes('Không tìm thấy người dùng')) {\n        setForm(_objectSpread(_objectSpread({}, form), {}, {\n          formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n            email: _objectSpread(_objectSpread({}, form.formdata.email), {}, {\n              valid: false,\n              validationMessage: 'Không tìm thấy người dùng'\n            })\n          })\n        }));\n      } else if (loginUserError.includes('Không thể đăng nhập bằng cách này')) {\n        message.error('Email này không thể đăng nhập bằng cách này');\n      } else {\n        message.error(loginUserError);\n      }\n    }\n  }, [loginUserError]);\n  return __jsx(\"div\", {\n    className: styles.loginWrapper\n  }, __jsx(\"div\", {\n    className: styles.title\n  }, \"\\u0110\\u0102NG NH\\u1EACP\"), __jsx(\"form\", {\n    onSubmit: function onSubmit(event) {\n      return submitForm(event);\n    }\n  }, __jsx(FormField, {\n    id: 'email',\n    formdata: form.formdata.email,\n    change: function change(e) {\n      return updateForm(e);\n    },\n    Prefix: userIcon,\n    press: function press(e) {\n      return handlePress(e);\n    }\n  }), __jsx(FormField, {\n    id: 'password',\n    formdata: form.formdata.password,\n    change: function change(e) {\n      return updateForm(e);\n    },\n    Prefix: passwordIcon,\n    press: function press(e) {\n      return handlePress(e);\n    }\n  }), form.formError && __jsx(\"div\", {\n    className: styles.errorLabel\n  }, \"Ki\\u1EC3m tra l\\u1EA1i th\\xF4ng tin\"), waiting && __jsx(\"div\", {\n    className: styles.waiting\n  }, __jsx(CircularProgress, {\n    className: styles.waitingIcon\n  })), __jsx(Button, {\n    onClick: function onClick(event) {\n      return submitForm(event);\n    },\n    style: {\n      backgroundColor: '#e91e63'\n    },\n    className: styles.button,\n    size: \"large\",\n    type: \"submit\"\n  }, \"X\\xE1c nh\\u1EADn\")), __jsx(\"div\", {\n    className: styles.thirdAuthen\n  }, __jsx(GoogleLogin, {\n    clientId: \"374918945235-8gdpha6da5h9sqva4mgi53ldreces79b.apps.googleusercontent.com\",\n    render: function render(renderProps) {\n      return __jsx(\"div\", {\n        className: styles.item,\n        onClick: renderProps.onClick\n      }, __jsx(\"div\", {\n        className: styles.icon\n      }, __jsx(\"img\", {\n        src: \"/icons/google.svg\",\n        alt: \"google\"\n      })), __jsx(\"div\", {\n        className: styles.text\n      }, \"\\u0110\\u0103ng nh\\u1EADp b\\u1EB1ng Google\"));\n    },\n    buttonText: \"Login\",\n    onSuccess: responseGoogle,\n    onFailure: responseGoogle,\n    cookiePolicy: 'single_host_origin'\n  }), __jsx(FacebookLogin, {\n    appId: \"659986671317584\" // autoLoad\n    ,\n    fields: \"name,email,picture,id\",\n    callback: responseFacebook,\n    render: function render(renderProps) {\n      return __jsx(\"div\", {\n        className: styles.item,\n        onClick: renderProps.onClick\n      }, __jsx(\"div\", {\n        className: styles.icon\n      }, __jsx(\"img\", {\n        src: \"/icons/facebook.svg\",\n        alt: \"facebook\"\n      })), __jsx(\"div\", {\n        className: styles.text\n      }, \"\\u0110\\u0103ng nh\\u1EADp b\\u1EB1ng Facebook\"));\n    }\n  })), __jsx(\"div\", {\n    className: styles.close,\n    onClick: close\n  }, __jsx(\"img\", {\n    src: \"/icons/close.svg\",\n    alt: \"close\"\n  })));\n}\n\n_s(Login, \"2eEjeNnBQTFP9zMeq4nLw0qKv6Q=\", false, function () {\n  return [useRouter];\n});\n\n_c = Login;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.users.data,\n    loginByGoogleError: state.users.loginByGoogleError,\n    loginByFacebookError: state.users.loginByFacebookError,\n    loginUserError: state.users.loginUserError\n  };\n};\n\nexport default connect(mapStateToProps, {\n  loginUser: loginUser,\n  loginByGoogle: loginByGoogle,\n  loginByFacebook: loginByFacebook\n})(Login);\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/media/robert/DATA/Work/web-project/phuong-nam/src-code/components/LoginRegister/Login/index.tsx"],"names":["React","useState","useEffect","update","generateData","isFormValid","FormField","styles","Button","loginUser","loginByGoogle","loginByFacebook","connect","useRouter","GoogleLogin","message","CircularProgress","FacebookLogin","Login","user","close","loginByGoogleError","loginUserError","loginByFacebookError","router","formError","formSuccess","formdata","email","element","value","config","name","type","placeholder","validation","required","valid","touched","validationMessage","password","form","setForm","waiting","setWaiting","userIcon","passwordIcon","updateForm","newFormdata","submitForm","e","preventDefault","dataToSubmit","formIsValid","responseGoogle","data","token","tokenId","profileObj","thirdPartyAvatar","imageUrl","googleId","responseFacebook","accessToken","facebookId","id","picture","url","handlePress","event","code","keyCode","which","role","console","log","document","cookie","error","includes","loginWrapper","title","errorLabel","waitingIcon","backgroundColor","button","thirdAuthen","renderProps","item","onClick","icon","text","mapStateToProps","state","users"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { update, generateData, isFormValid } from '../../utils/formAction';\nimport FormField from '../../FormField';\nimport styles from './Login.module.scss';\nimport Button from '@material-ui/core/Button';\nimport { loginUser, loginByGoogle, loginByFacebook } from 'redux/actions/users';\nimport { connect } from 'react-redux';\nimport { useRouter } from 'next/router';\nimport GoogleLogin from 'react-google-login';\nimport { message } from 'antd';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n// @ts-ignore\nimport FacebookLogin from 'react-facebook-login/dist/facebook-login-render-props';\ninterface Props {\n  loginUser(data: DataSubmit): any;\n  user: any;\n  close(): void;\n  loginByGoogle: any;\n  loginByGoogleError: any;\n  loginUserError: any;\n  loginByFacebookError: any;\n  loginByFacebook: any;\n}\n\ninterface DataSubmit {\n  email: string;\n  password: string;\n}\n\nfunction Login({\n  user,\n  loginUser,\n  close,\n  loginByGoogle,\n  loginByGoogleError,\n  loginUserError,\n  loginByFacebookError,\n  loginByFacebook,\n}: Props) {\n  const router = useRouter();\n  const [form, setForm] = useState({\n    formError: false,\n    formSuccess: '',\n    formdata: {\n      email: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'email_input',\n          type: 'email',\n          placeholder: 'Email',\n        },\n        validation: {\n          required: true,\n          email: true,\n        },\n        valid: false,\n        touched: false,\n        validationMessage: '',\n      },\n      password: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'password_input',\n          type: 'password',\n          placeholder: 'Mật khẩu',\n        },\n        validation: {\n          required: true,\n        },\n        valid: false,\n        touched: false,\n        validationMessage: '',\n      },\n    },\n  });\n\n  const [waiting, setWaiting] = useState(false);\n\n  const userIcon = () => <img src=\"/icons/user.svg\" alt=\"user\" />;\n  const passwordIcon = () => <img src=\"/icons/password.svg\" alt=\"password\" />;\n\n  const updateForm = (element: any) => {\n    const newFormdata: any = update(element, form.formdata, 'login');\n\n    setForm({\n      ...form,\n      formError: false,\n      formdata: newFormdata,\n    });\n  };\n\n  const submitForm = (e: any): void => {\n    e.preventDefault();\n\n    const dataToSubmit = generateData(form.formdata, 'login');\n    const formIsValid = isFormValid(form.formdata, 'login');\n    // console.log(form.formdata);\n    if (formIsValid) {\n      loginUser(dataToSubmit);\n      setWaiting(true);\n    } else {\n      setForm({\n        ...form,\n        formError: true,\n      });\n    }\n  };\n\n  const responseGoogle = (data: any) => {\n    loginByGoogle({\n      token: data.tokenId,\n      name: data.profileObj.name,\n      thirdPartyAvatar: data.profileObj.imageUrl,\n      email: data.profileObj.email,\n      googleId: data.googleId,\n    });\n  };\n\n  const responseFacebook = (data: any) => {\n    // console.log(data);\n    loginByFacebook({\n      token: data.accessToken,\n      name: data.name,\n      email: data.email,\n      facebookId: data.id,\n      thirdPartyAvatar: data.picture.data.url,\n    });\n  };\n\n  const handlePress = (event: any) => {\n    const code = event.keyCode || event.which;\n    if (code === 13) {\n      //13 is the enter keycode\n      //Do stuff in here\n      submitForm(event);\n    }\n  };\n\n  useEffect(() => {\n    if (user) {\n      if (user.role > 0) {\n        // router.push('/admin');\n        console.log(user)\n        document.cookie = `spn_auth=${user.token}`\n      } else {\n        close();\n      }\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (loginByGoogleError) {\n      message.error(loginByGoogleError);\n    }\n  }, [loginByGoogleError]);\n\n  useEffect(() => {\n    if (loginByFacebookError) {\n      message.error(loginByFacebookError);\n    }\n  }, [loginByFacebookError]);\n\n  useEffect(() => {\n    if (loginUserError) {\n      setWaiting(false);\n      if (loginUserError.includes('Sai mật khẩu')) {\n        setForm({\n          ...form,\n          formdata: {\n            ...form.formdata,\n            password: {\n              ...form.formdata.password,\n              valid: false,\n              validationMessage: 'Sai mật khẩu',\n            },\n          },\n        });\n      } else if (loginUserError.includes('Không tìm thấy người dùng')) {\n        setForm({\n          ...form,\n          formdata: {\n            ...form.formdata,\n            email: {\n              ...form.formdata.email,\n              valid: false,\n              validationMessage: 'Không tìm thấy người dùng',\n            },\n          },\n        });\n      } else if (loginUserError.includes('Không thể đăng nhập bằng cách này')) {\n        message.error('Email này không thể đăng nhập bằng cách này');\n      } else {\n        message.error(loginUserError);\n      }\n    }\n  }, [loginUserError]);\n\n  return (\n    <div className={styles.loginWrapper}>\n      <div className={styles.title}>ĐĂNG NHẬP</div>\n      <form onSubmit={(event) => submitForm(event)}>\n        <FormField\n          id={'email'}\n          formdata={form.formdata.email}\n          change={(e: any) => updateForm(e)}\n          Prefix={userIcon}\n          press={(e: any) => handlePress(e)}\n        />\n        <FormField\n          id={'password'}\n          formdata={form.formdata.password}\n          change={(e: any) => updateForm(e)}\n          Prefix={passwordIcon}\n          press={(e: any) => handlePress(e)}\n        />\n        {form.formError && <div className={styles.errorLabel}>Kiểm tra lại thông tin</div>}\n        {waiting && (\n          <div className={styles.waiting}>\n            <CircularProgress className={styles.waitingIcon} />\n          </div>\n        )}\n        <Button\n          onClick={(event) => submitForm(event)}\n          style={{ backgroundColor: '#e91e63' }}\n          className={styles.button}\n          size=\"large\"\n          type=\"submit\"\n        >\n          Xác nhận\n        </Button>\n      </form>\n      <div className={styles.thirdAuthen}>\n        <GoogleLogin\n          clientId=\"374918945235-8gdpha6da5h9sqva4mgi53ldreces79b.apps.googleusercontent.com\"\n          render={(renderProps) => (\n            <div className={styles.item} onClick={renderProps.onClick}>\n              <div className={styles.icon}>\n                <img src=\"/icons/google.svg\" alt=\"google\" />\n              </div>\n              <div className={styles.text}>Đăng nhập bằng Google</div>\n            </div>\n          )}\n          buttonText=\"Login\"\n          onSuccess={responseGoogle}\n          onFailure={responseGoogle}\n          cookiePolicy={'single_host_origin'}\n        />\n        <FacebookLogin\n          appId=\"659986671317584\"\n          // autoLoad\n          fields=\"name,email,picture,id\"\n          callback={responseFacebook}\n          render={(renderProps: any) => (\n            <div className={styles.item} onClick={renderProps.onClick}>\n              <div className={styles.icon}>\n                <img src=\"/icons/facebook.svg\" alt=\"facebook\" />\n              </div>\n              <div className={styles.text}>Đăng nhập bằng Facebook</div>\n            </div>\n          )}\n        />\n      </div>\n      <div className={styles.close} onClick={close}>\n        <img src=\"/icons/close.svg\" alt=\"close\" />\n      </div>\n    </div>\n  );\n}\n\nconst mapStateToProps = (state: any) => ({\n  user: state.users.data,\n  loginByGoogleError: state.users.loginByGoogleError,\n  loginByFacebookError: state.users.loginByFacebookError,\n  loginUserError: state.users.loginUserError,\n});\n\nexport default connect(mapStateToProps, { loginUser, loginByGoogle, loginByFacebook })(Login);\n"]},"metadata":{},"sourceType":"module"}