{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { getPostsByAdmin } from 'redux/actions/posts';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport styles from './AdminPosts.module.scss';\nimport TopAdminTable from '../TopAdminTable';\nimport { Table, Tag, Space, Popconfirm, message, Switch } from 'antd';\nimport { CloseOutlined, CheckOutlined } from '@ant-design/icons';\nimport FormField from '../FormField';\nimport Button from '@material-ui/core/Button';\nimport { update, generateData, isFormValid } from 'components/utils/formAction';\nimport { createPost, deletePost, updatePublish, updatePost } from 'redux/actions/posts';\n\nfunction AdminPosts({\n  posts,\n  getPostsByAdmin,\n  createPost,\n  deletePost,\n  getPostsError,\n  createPostError,\n  deletePostError,\n  updatePublish,\n  updatePost,\n  updatePublishError,\n  updatePostError\n}) {\n  const initialForm = {\n    formError: false,\n    formMessage: '',\n    formdata: {\n      title: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'title_input',\n          type: 'title',\n          // placeholder: 'Email',\n          label: 'Tiêu đề'\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      },\n      type: {\n        element: 'select',\n        value: 'Dự án',\n        config: {\n          name: 'type_input',\n          type: 'type',\n          label: 'Thể loại',\n          options: [{\n            value: 'Dự án'\n          }, {\n            value: 'Dịch vụ'\n          }, {\n            value: 'Kiến thức'\n          }]\n        },\n        validation: {\n          required: true\n        },\n        valid: true,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      },\n      image: {\n        element: 'image',\n        value: '',\n        config: {\n          label: 'Ảnh đại diện',\n          placeholder: ''\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        showlabel: true,\n        touched: true,\n        validationMessage: 'Bạn phải nhập mục này'\n      },\n      content: {\n        element: 'rich_text',\n        value: '',\n        config: {\n          name: 'content_input',\n          type: 'content',\n          // placeholder: 'Email',\n          label: 'Nội dung'\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      }\n    }\n  };\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    0: edit,\n    1: setEdit\n  } = useState({\n    active: false,\n    status: 'none'\n  });\n  const {\n    0: form,\n    1: setForm\n  } = useState(initialForm);\n  const {\n    0: isWaiting,\n    1: setWaiting\n  } = useState(false);\n  const columns = [{\n    title: 'Tên bài viết',\n    dataIndex: 'title',\n    key: 'title'\n  }, {\n    title: 'Thể loại',\n    dataIndex: 'type',\n    key: 'type',\n    render: type => {\n      if (type === 'info') {\n        return __jsx(Tag, {\n          color: \"green\"\n        }, \"Ki\\u1EBFn th\\u1EE9c\");\n      } else if (type === 'service') {\n        return __jsx(Tag, {\n          color: \"blue\"\n        }, \"D\\u1ECBch v\\u1EE5\");\n      } else {\n        return __jsx(Tag, {\n          color: \"orange\"\n        }, \"D\\u1EF1 \\xE1n \");\n      }\n    }\n  }, {\n    title: 'Xuất bản',\n    dataIndex: 'publish',\n    key: 'publish',\n    render: (publish, record) => __jsx(Switch, {\n      defaultChecked: publish,\n      checkedChildren: __jsx(CheckOutlined, null),\n      unCheckedChildren: __jsx(CloseOutlined, null),\n      onChange: check => handleSwitchChange(check, record._id)\n    })\n  }, {\n    title: 'Hành động',\n    key: 'action',\n    render: record => __jsx(Space, {\n      size: \"middle\"\n    }, __jsx(\"a\", {\n      onClick: e => handleEdit(e, record.urlTitle)\n    }, \"S\\u1EEDa\"), __jsx(Popconfirm, {\n      title: \"B\\u1EA1n c\\xF3 mu\\u1ED1n x\\xF3a b\\xE0i vi\\u1EBFt n\\xE0y?\",\n      onConfirm: () => handleDelete(record._id),\n      okText: \"X\\xF3a\",\n      cancelText: \"Kh\\xF4ng\"\n    }, __jsx(\"a\", null, \"X\\xF3a\")))\n  }]; // @ts-ignore\n\n  const handleEdit = (e, urlTitle) => {\n    const postsArr = Object.values(posts);\n    const selectedPost = postsArr.find(post => post.urlTitle === urlTitle);\n    setEdit({\n      active: true,\n      status: selectedPost._id\n    });\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n        title: _objectSpread(_objectSpread({}, form.formdata.title), {}, {\n          value: selectedPost.title,\n          valid: true\n        }),\n        type: _objectSpread(_objectSpread({}, form.formdata.type), {}, {\n          value: setType(selectedPost.type),\n          valid: true\n        }),\n        content: _objectSpread(_objectSpread({}, form.formdata.content), {}, {\n          value: selectedPost.content,\n          valid: true\n        }),\n        image: _objectSpread(_objectSpread({}, form.formdata.image), {}, {\n          value: `/api/post/image/${urlTitle}`,\n          valid: true\n        })\n      })\n    }));\n  };\n\n  const setType = type => {\n    if (type === 'project') {\n      return 'Dự án';\n    } else if (type === 'service') {\n      return 'Dịch vụ';\n    } else {\n      return 'Kiến thức';\n    }\n  };\n\n  const handleSwitchChange = (check, id) => {\n    updatePublish({\n      publish: check,\n      id\n    });\n  };\n\n  const handleDelete = id => {\n    deletePost({\n      id\n    });\n  };\n\n  const handleCreatePost = () => {\n    setEdit({\n      active: true,\n      status: 'create'\n    });\n    setWaiting(false);\n    setForm(initialForm);\n  };\n\n  const updateForm = element => {\n    const newFormdata = update(element, form.formdata, 'posts');\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      formError: false,\n      formdata: newFormdata\n    }));\n  };\n\n  const submitForm = e => {\n    e.preventDefault();\n    const dataToSubmit = generateData(form.formdata, 'posts');\n    const formIsValid = isFormValid(form.formdata, 'posts');\n\n    if (formIsValid) {\n      setWaiting(true);\n\n      if (edit.active && edit.status === 'create') {\n        createPost(dataToSubmit);\n      } else {\n        updatePost(_objectSpread(_objectSpread({}, dataToSubmit), {}, {\n          id: edit.status\n        }));\n      }\n    } else {\n      setForm(_objectSpread(_objectSpread({}, form), {}, {\n        formError: true,\n        formMessage: 'Kiểm tra lại thông tin'\n      }));\n    }\n  };\n\n  const exitForm = e => {\n    e.preventDefault();\n    setEdit({\n      active: false,\n      status: 'none'\n    });\n    setWaiting(false);\n  };\n\n  useEffect(() => {\n    getPostsByAdmin();\n  }, []);\n  useEffect(() => {\n    if (getPostsError) {\n      message.error(getPostsError);\n    }\n  }, [getPostsError]);\n  useEffect(() => {\n    if (deletePostError) {\n      message.error(deletePostError);\n    }\n  }, [deletePostError]);\n  useEffect(() => {\n    if (updatePublishError) {\n      message.error(updatePublishError);\n    }\n  }, [updatePublishError]);\n  useEffect(() => {\n    if (updatePostError) {\n      message.error(updatePostError);\n    }\n  }, [updatePostError]);\n  useEffect(() => {\n    if (createPostError) {\n      setWaiting(false);\n      setForm(_objectSpread(_objectSpread({}, form), {}, {\n        formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n          title: _objectSpread(_objectSpread({}, form.formdata.title), {}, {\n            valid: false,\n            validationMessage: 'Tên bài viết đã tồn tại'\n          })\n        })\n      }));\n    }\n  }, [createPostError]);\n  useEffect(() => {\n    if (posts) {\n      setLoading(false);\n      setWaiting(false);\n      setEdit({\n        active: false,\n        status: 'none'\n      });\n    }\n  }, [posts]);\n\n  if (loading) {\n    return __jsx(\"div\", {\n      className: styles.loading\n    }, __jsx(CircularProgress, {\n      size: 50,\n      thickness: 4\n    }));\n  } else if (edit.active) {\n    return __jsx(\"div\", {\n      className: styles.formContainer\n    }, __jsx(\"form\", null, __jsx(\"div\", {\n      className: styles.title,\n      onSubmit: event => submitForm(event)\n    }, edit.status === 'create' ? 'Thêm bài viết' : 'Sửa bài viết'), __jsx(FormField, {\n      id: 'title',\n      formdata: form.formdata.title,\n      change: e => updateForm(e)\n    }), __jsx(FormField, {\n      id: 'type',\n      formdata: form.formdata.type,\n      change: e => updateForm(e)\n    }), __jsx(FormField, {\n      id: 'image',\n      formdata: form.formdata.image,\n      change: e => updateForm(e)\n    }), __jsx(FormField, {\n      id: 'content',\n      formdata: form.formdata.content,\n      change: e => updateForm(e)\n    }), form.formError && __jsx(\"div\", {\n      className: styles.errorLabel\n    }, form.formMessage), isWaiting && __jsx(\"div\", {\n      className: styles.waiting\n    }, __jsx(CircularProgress, {\n      color: \"secondary\"\n    })), __jsx(\"div\", {\n      className: styles.buttonWrapper\n    }, __jsx(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      className: styles.button,\n      onClick: event => exitForm(event)\n    }, \"H\\u1EE7y\"), __jsx(Button, {\n      variant: \"contained\",\n      color: \"secondary\",\n      className: styles.button,\n      onClick: event => submitForm(event),\n      type: \"submit\"\n    }, \"X\\xE1c nh\\u1EADn\"))));\n  } else {\n    return __jsx(\"div\", {\n      className: styles.container\n    }, __jsx(\"div\", {\n      className: styles.topWrapper\n    }, __jsx(TopAdminTable, {\n      handleCreate: handleCreatePost\n    })), __jsx(\"div\", {\n      className: styles.tableWrapper\n    }, __jsx(Table, {\n      columns: columns,\n      dataSource: posts,\n      rowKey: record => record._id\n    })));\n  }\n}\n\nconst mapStateToProps = state => ({\n  posts: state.posts.postsByAdmin,\n  getPostsError: state.posts.getPostsByAdminError,\n  createPostError: state.posts.createPostError,\n  deletePostError: state.posts.deletePostError,\n  updatePublishError: state.posts.updatePublishError,\n  updatePostError: state.posts.updatePostError\n});\n\nexport default connect(mapStateToProps, {\n  getPostsByAdmin,\n  createPost,\n  deletePost,\n  updatePublish,\n  updatePost\n})(AdminPosts);","map":null,"metadata":{},"sourceType":"module"}