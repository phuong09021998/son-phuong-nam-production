{"ast":null,"code":"var __jsx = React.createElement;\n//@ts-nocheck\n// vendors\nimport React, { useState, useImperativeHandle, useEffect, useRef, forwardRef, useCallback, useMemo } from 'react';\nimport { Picker } from 'emoji-mart';\nimport t from 'prop-types';\nimport LazyLoad from 'react-lazy-load'; // utils\n\nimport useDebounce from './use-debounce';\n\nfunction InputEmoji({\n  value,\n  onChange,\n  cleanOnEnter,\n  onEnter,\n  placeholder,\n  onResize,\n  onClick,\n  onFocus,\n  maxLength,\n  keepOpenend,\n  onKeyDown,\n  inputClass,\n  disableRecent,\n  tabIndex,\n  // style\n  // height,\n  borderRadius,\n  borderColor,\n  fontSize,\n  fontFamily\n}, ref) {\n  const {\n    0: showPicker,\n    1: setShowPicker\n  } = useState(false);\n  const {\n    0: allEmojiStyle,\n    1: setAllEmojiStyle\n  } = useState({});\n  const {\n    0: currentSize,\n    1: setCurrentSize\n  } = useState(null);\n  const textInputRef = useRef(null);\n  const cleanedTextRef = useRef('');\n  const placeholderRef = useRef(null);\n  useImperativeHandle(ref, () => ({\n    get value() {\n      return cleanedTextRef.current;\n    },\n\n    set value(value) {\n      setValue(value);\n    },\n\n    focus: () => {\n      textInputRef.current.focus();\n    },\n    blur: () => {\n      replaceAllTextEmojiToString();\n    }\n  }));\n  const replaceAllTextEmojis = useCallback(text => {\n    let allEmojis = getAllEmojisFromText(text);\n\n    if (allEmojis) {\n      allEmojis = [...new Set(allEmojis)]; // remove duplicates\n\n      allEmojis.forEach(emoji => {\n        const style = allEmojiStyle[emoji];\n        if (!style) return;\n        text = replaceAll(text, emoji, `<img style=\"${style}\" data-emoji=\"${emoji}\" src=\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\" />`);\n      });\n    }\n\n    return text;\n  }, [allEmojiStyle]);\n  const updateHTML = useCallback(nextValue => {\n    nextValue = nextValue || value;\n    textInputRef.current.innerHTML = replaceAllTextEmojis(nextValue || '');\n  }, [replaceAllTextEmojis]);\n  const checkAndEmitResize = useCallback(() => {\n    const nextSize = {\n      width: textInputRef.current.offsetWidth,\n      height: textInputRef.current.offsetHeight\n    };\n\n    if (!currentSize || currentSize.width !== nextSize.width || currentSize.height !== nextSize.height) {\n      onResize(nextSize);\n      setCurrentSize(nextSize);\n    }\n  }, [currentSize, onResize]);\n  const emitChange = useCallback(() => {\n    if (typeof onChange === 'function') {\n      onChange(cleanedTextRef.current);\n    }\n\n    if (typeof onResize === 'function') {\n      checkAndEmitResize();\n    }\n  }, [checkAndEmitResize, onChange, onResize]);\n  useEffect(() => {\n    function handleCopy(e) {\n      const selectedText = window.getSelection();\n      let container = document.createElement('div');\n\n      for (let i = 0, len = selectedText.rangeCount; i < len; ++i) {\n        container.appendChild(selectedText.getRangeAt(i).cloneContents());\n      }\n\n      container = replaceEmojiToString(container);\n      e.clipboardData.setData('text', container.innerText);\n      e.preventDefault();\n\n      function replaceEmojiToString(container) {\n        const images = Array.prototype.slice.call(container.querySelectorAll('img'));\n        images.forEach(image => {\n          image.outerHTML = image.dataset.emoji;\n        });\n        return container;\n      }\n    }\n\n    function handlePaste(e) {\n      e.preventDefault();\n      let content;\n\n      if (window.clipboardData) {\n        content = window.clipboardData.getData('Text');\n        content = replaceAllTextEmojis(content);\n\n        if (window.getSelection) {\n          const selObj = window.getSelection();\n          const selRange = selObj.getRangeAt(0);\n          selRange.deleteContents();\n          selRange.insertNode(document.createTextNode(content));\n        }\n      } else if (e.clipboardData) {\n        content = e.clipboardData.getData('text/plain');\n        content = replaceAllTextEmojis(content);\n        document.execCommand('insertHTML', false, content);\n      }\n    }\n\n    const inputEl = textInputRef.current;\n\n    const handleContentEditableInputCopyAndPaste = () => {\n      inputEl.addEventListener('copy', handleCopy);\n      inputEl.addEventListener('paste', handlePaste);\n    };\n\n    handleContentEditableInputCopyAndPaste();\n    return () => {\n      inputEl.removeEventListener('copy', handleCopy);\n      inputEl.removeEventListener('paste', handlePaste);\n    };\n  }, [replaceAllTextEmojis]);\n  useEffect(() => {\n    const allEmojiButton = Array.prototype.slice.call(document.querySelectorAll('.emoji-mart-category-list > li > button'));\n    const allEmojiStyle = {};\n    allEmojiButton.forEach(emojiButton => {\n      const label = emojiButton.getAttribute('aria-label');\n      const [emoji] = label.split(',');\n      const emojiSpanEl = emojiButton.querySelector('span');\n      const style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n      allEmojiStyle[emoji] = style;\n    });\n    setAllEmojiStyle(allEmojiStyle);\n  }, []);\n  useEffect(() => {\n    updateHTML();\n  }, [updateHTML]);\n  const replaceAllTextEmojiToString = useCallback(() => {\n    if (!textInputRef.current) {\n      cleanedTextRef.current = '';\n    }\n\n    const container = document.createElement('div');\n    container.innerHTML = textInputRef.current.innerHTML;\n    const images = Array.prototype.slice.call(container.querySelectorAll('img'));\n    images.forEach(image => {\n      image.outerHTML = image.dataset.emoji;\n    });\n    let text = container.innerText; // remove all â†µ for safari\n\n    text = text.replace(/\\n/gi, '');\n    cleanedTextRef.current = text;\n    checkPlaceholder();\n    emitChange();\n  }, [emitChange]);\n  const [replaceAllTextEmojiToStringDebounced] = useDebounce(replaceAllTextEmojiToString, 500);\n  useEffect(() => {\n    function handleKeydown(event) {\n      placeholderRef.current.style.opacity = 0;\n\n      if (typeof maxLength !== 'undefined' && event.keyCode !== 8 && totalCharacters() >= maxLength) {\n        event.preventDefault();\n      }\n\n      if (event.keyCode === 13) {\n        event.preventDefault();\n        replaceAllTextEmojiToString();\n        const cleanedText = cleanedTextRef.current;\n\n        if (typeof onEnter === 'function') {\n          onEnter(cleanedText);\n        }\n\n        if (cleanOnEnter) {\n          updateHTML('');\n        }\n\n        if (typeof onKeyDown === 'function') {\n          onKeyDown(event);\n        }\n\n        return false;\n      }\n\n      if (typeof onKeyDown === 'function') {\n        onKeyDown(event);\n      }\n    }\n\n    function handleKeyup() {\n      replaceAllTextEmojiToStringDebounced();\n    }\n\n    const inputEl = textInputRef.current;\n    inputEl.addEventListener('keydown', handleKeydown);\n    inputEl.addEventListener('keyup', handleKeyup);\n    return () => {\n      inputEl.removeEventListener('keydown', handleKeydown);\n      inputEl.removeEventListener('keyup', handleKeyup);\n    };\n  }, [onChange, cleanOnEnter, onEnter, updateHTML, replaceAllTextEmojiToString, replaceAllTextEmojiToStringDebounced, emitChange, maxLength, onKeyDown]);\n  useEffect(() => {\n    function handleFocus() {\n      if (typeof onFocus === 'function') {\n        onFocus();\n      }\n    }\n\n    const inputEl = textInputRef.current;\n    inputEl.addEventListener('focus', handleFocus);\n    return () => {\n      inputEl.removeEventListener('focus', handleFocus);\n    };\n  }, [onFocus]);\n\n  function totalCharacters() {\n    const text = textInputRef.current.innerText;\n    const html = textInputRef.current.innerHTML;\n    const textCount = text.length;\n    const emojisCount = (html.match(/<img/g) || []).length;\n    return textCount + emojisCount;\n  }\n\n  useEffect(() => {\n    if (textInputRef.current) {\n      setCurrentSize({\n        width: textInputRef.current.offsetWidth,\n        height: textInputRef.current.offsetHeight\n      });\n    }\n  }, []);\n  const excluePicker = useMemo(() => {\n    const exclude = [];\n\n    if (disableRecent) {\n      exclude.push('recent');\n    }\n\n    return exclude;\n  }, [disableRecent]);\n\n  function setValue(value) {\n    updateHTML(value);\n    textInputRef.current.blur();\n  }\n\n  function toggleShowPicker() {\n    setShowPicker(showPicker => !showPicker);\n  }\n\n  function pasteHtmlAtCaret(html) {\n    let sel, range;\n\n    if (window.getSelection) {\n      // IE9 and non-IE\n      sel = window.getSelection();\n\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents(); // Range.createContextualFragment() would be useful here but is\n        // non-standard and not supported in all browsers (IE9, for one)\n\n        const el = document.createElement('div');\n        el.innerHTML = html;\n        const frag = document.createDocumentFragment();\n        let node;\n        let lastNode;\n\n        while (node = el.firstChild) {\n          lastNode = frag.appendChild(node);\n        }\n\n        range.insertNode(frag); // Preserve the selection\n\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    } else if (document.selection && document.selection.type !== 'Control') {\n      // IE < 9\n      document.selection.createRange().pasteHTML(html);\n    }\n  }\n\n  function replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n  }\n\n  function getImage(emoji) {\n    let shortNames = `${emoji.short_names}`;\n    shortNames = replaceAll(shortNames, ',', ', ');\n    const emojiSpanEl = document.querySelector(`[aria-label=\"${emoji.native}, ${shortNames}\"] > span`);\n    if (!emojiSpanEl) return '';\n    const style = replaceAll(emojiSpanEl.style.cssText, '\"', \"'\");\n    return `<img style=\"${style}\" data-emoji=\"${emoji.native}\" src=\"https://upload.wikimedia.org/wikipedia/commons/c/ce/Transparent.gif\" />`;\n  }\n\n  function handleSelectEmoji(emoji) {\n    placeholderRef.current.style.opacity = 0;\n    textInputRef.current.focus();\n    pasteHtmlAtCaret(getImage(emoji));\n    textInputRef.current.focus();\n    emitChange();\n\n    if (!keepOpenend) {\n      toggleShowPicker();\n    }\n  }\n\n  function getAllEmojisFromText(text) {\n    return text.match(/(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?)*/g);\n  }\n\n  function checkPlaceholder() {\n    const text = cleanedTextRef.current;\n\n    if (text !== '' && placeholderRef.current.opacity !== 0) {\n      placeholderRef.current.style.opacity = 0;\n    } else {\n      placeholderRef.current.style.opacity = 1;\n    }\n  }\n\n  function handleClick() {\n    if (typeof onClick === 'function') {\n      onClick();\n    }\n  }\n\n  return __jsx(\"div\", {\n    className: \"react-emoji\"\n  }, __jsx(\"div\", {\n    className: \"react-emoji-picker--container\"\n  }, __jsx(\"div\", {\n    className: `react-emoji-picker--wrapper${showPicker ? ' react-emoji-picker--wrapper__show' : ''}`\n  }, __jsx(\"div\", {\n    className: `react-emoji-picker${showPicker ? ' react-emoji-picker__show' : ''}`\n  }, __jsx(LazyLoad, null, __jsx(Picker, {\n    showPreview: false,\n    showSkinTones: false,\n    set: \"apple\",\n    onSelect: handleSelectEmoji,\n    exclude: excluePicker\n  }))))), __jsx(\"div\", {\n    className: \"react-input-emoji--container\",\n    style: {\n      borderRadius,\n      borderColor,\n      fontSize,\n      fontFamily\n    }\n  }, __jsx(\"div\", {\n    className: \"react-input-emoji--wrapper\",\n    onClick: handleClick\n  }, __jsx(\"div\", {\n    ref: placeholderRef,\n    className: \"react-input-emoji--placeholder\"\n  }, placeholder), __jsx(\"div\", {\n    ref: textInputRef,\n    tabIndex: tabIndex,\n    contentEditable: true,\n    className: `react-input-emoji--input${inputClass ? ` ${inputClass}` : ''}`,\n    onBlur: emitChange\n  }))), __jsx(\"button\", {\n    className: `react-input-emoji--button${showPicker ? ' react-input-emoji--button__show' : ''}`,\n    onClick: toggleShowPicker\n  }, __jsx(\"img\", {\n    src: \"/icons/smile.svg\",\n    alt: \"smile\",\n    style: {\n      width: '1.5em'\n    }\n  })), showPicker && __jsx(\"div\", {\n    className: \"react-input-emoji--overlay\",\n    onClick: toggleShowPicker\n  }));\n}\n\nconst InputEmojiWithRef = forwardRef(InputEmoji);\nInputEmojiWithRef.propTypes = {\n  value: t.string,\n  onChange: t.func,\n  cleanOnEnter: t.bool,\n  onEnter: t.func,\n  placeholder: t.string,\n  onResize: t.func,\n  onClick: t.func,\n  onFocus: t.func,\n  maxLength: t.number,\n  keepOpenend: t.bool,\n  onKeyDown: t.func,\n  inputClass: t.string,\n  disableRecent: t.bool,\n  tabIndex: t.number,\n  // style\n  height: t.number,\n  borderRadius: t.number,\n  borderColor: t.string,\n  fontSize: t.number,\n  fontFamily: t.string\n};\nInputEmojiWithRef.defaultProps = {\n  height: 30,\n  placeholder: 'Type a message',\n  borderRadius: 21,\n  borderColor: '#EAEAEA',\n  fontSize: 15,\n  fontFamily: 'sans-serif',\n  tabIndex: 0\n};\nexport default InputEmojiWithRef;","map":null,"metadata":{},"sourceType":"module"}