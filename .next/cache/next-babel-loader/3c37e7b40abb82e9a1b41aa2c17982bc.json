{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { getProductsByAdmin, createProduct, deleteProduct, updatePublish, updateProduct, updateAvailable } from 'redux/actions/products';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport styles from './AdminPosts.module.scss';\nimport TopAdminTable from '../TopAdminTable';\nimport { Table, Space, Popconfirm, message, Switch } from 'antd';\nimport { CloseOutlined, CheckOutlined } from '@ant-design/icons';\nimport FormField from '../FormField';\nimport Button from '@material-ui/core/Button';\nimport { update, generateData, isFormValid } from 'components/utils/formAction'; // @ts-ignore\n\nimport currencyFormatter from 'currency-formatter';\n\nfunction AdminProducts(_ref) {\n  var products = _ref.products,\n      getProductsByAdmin = _ref.getProductsByAdmin,\n      createProduct = _ref.createProduct,\n      deleteProduct = _ref.deleteProduct,\n      getProductsError = _ref.getProductsError,\n      createProductError = _ref.createProductError,\n      deleteProductError = _ref.deleteProductError,\n      updatePublish = _ref.updatePublish,\n      updateProduct = _ref.updateProduct,\n      updatePublishError = _ref.updatePublishError,\n      updateProductError = _ref.updateProductError,\n      updateAvailableError = _ref.updateAvailableError,\n      updateAvailable = _ref.updateAvailable;\n  var initialForm = {\n    formError: false,\n    formMessage: '',\n    formdata: {\n      name: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'name_input',\n          type: 'text',\n          // placeholder: 'Email',\n          label: 'Tên sản phẩm'\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      },\n      image: {\n        element: 'image',\n        value: '',\n        config: {\n          label: 'Ảnh đại diện',\n          placeholder: ''\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        showlabel: true,\n        touched: true,\n        validationMessage: 'Bạn phải nhập mục này'\n      },\n      price: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'price_input',\n          type: 'number',\n          // placeholder: 'Email',\n          label: 'Giá'\n        },\n        validation: {\n          required: true\n        },\n        valid: false,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      },\n      salePrice: {\n        element: 'input',\n        value: '',\n        config: {\n          name: 'sale_price_input',\n          type: 'number',\n          // placeholder: 'Email',\n          label: 'Giá khuyến mãi'\n        },\n        validation: {\n          required: false\n        },\n        valid: true,\n        touched: false,\n        showlabel: true,\n        validationMessage: ''\n      }\n    }\n  };\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState({\n    active: false,\n    status: 'none'\n  }),\n      edit = _useState2[0],\n      setEdit = _useState2[1];\n\n  var _useState3 = useState(initialForm),\n      form = _useState3[0],\n      setForm = _useState3[1];\n\n  var _useState4 = useState(false),\n      isWaiting = _useState4[0],\n      setWaiting = _useState4[1];\n\n  var columns = [{\n    title: 'Tên sản phẩm',\n    dataIndex: 'name',\n    key: 'name'\n  }, {\n    title: 'Giá',\n    dataIndex: 'price',\n    key: 'price',\n    // @ts-ignore\n    render: function render(price, doc) {\n      if (doc.salePrice) {\n        return currencyFormatter.format(doc.salePrice, {\n          code: 'VND'\n        });\n      } else {\n        return currencyFormatter.format(doc.price, {\n          code: 'VND'\n        });\n      }\n    }\n  }, {\n    title: 'Xuất bản',\n    dataIndex: 'publish',\n    key: 'publish',\n    render: function render(publish, record) {\n      return __jsx(Switch, {\n        defaultChecked: publish,\n        checkedChildren: __jsx(CheckOutlined, null),\n        unCheckedChildren: __jsx(CloseOutlined, null),\n        onChange: function onChange(check) {\n          return handleSwitchChange(check, record._id);\n        }\n      });\n    }\n  }, {\n    title: 'Hết hàng / Có sẵn',\n    dataIndex: 'available',\n    key: 'available',\n    render: function render(available, record) {\n      return __jsx(Switch, {\n        defaultChecked: available,\n        checkedChildren: __jsx(CheckOutlined, null),\n        unCheckedChildren: __jsx(CloseOutlined, null),\n        onChange: function onChange(check) {\n          return handleSwitchAvailableChange(check, record._id);\n        }\n      });\n    }\n  }, {\n    title: 'Hành động',\n    key: 'action',\n    render: function render(record) {\n      return __jsx(Space, {\n        size: \"middle\"\n      }, __jsx(\"a\", {\n        onClick: function onClick(e) {\n          return handleEdit(e, record.urlTitle);\n        }\n      }, \"S\\u1EEDa\"), __jsx(Popconfirm, {\n        title: \"B\\u1EA1n c\\xF3 mu\\u1ED1n s\\u1EA3n ph\\u1EA9m n\\xE0y?\",\n        onConfirm: function onConfirm() {\n          return handleDelete(record._id);\n        },\n        okText: \"X\\xF3a\",\n        cancelText: \"Kh\\xF4ng\"\n      }, __jsx(\"a\", null, \"X\\xF3a\")));\n    }\n  }]; // @ts-ignore\n\n  var handleEdit = function handleEdit(e, urlTitle) {\n    var productsArr = Object.values(products);\n    var selectedProduct = productsArr.find(function (product) {\n      return product.urlTitle === urlTitle;\n    });\n    setEdit({\n      active: true,\n      status: selectedProduct._id\n    });\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n        name: _objectSpread(_objectSpread({}, form.formdata.name), {}, {\n          value: selectedProduct.name,\n          valid: true\n        }),\n        price: _objectSpread(_objectSpread({}, form.formdata.price), {}, {\n          value: selectedProduct.price,\n          valid: true\n        }),\n        salePrice: _objectSpread(_objectSpread({}, form.formdata.salePrice), {}, {\n          value: selectedProduct.salePrice,\n          valid: true\n        }),\n        image: _objectSpread(_objectSpread({}, form.formdata.image), {}, {\n          value: \"/api/product/image/\".concat(urlTitle),\n          valid: true\n        })\n      })\n    }));\n  };\n\n  var handleSwitchChange = function handleSwitchChange(check, id) {\n    updatePublish({\n      publish: check,\n      id: id\n    });\n  };\n\n  var handleSwitchAvailableChange = function handleSwitchAvailableChange(check, id) {\n    updateAvailable({\n      available: check,\n      id: id\n    });\n  };\n\n  var handleDelete = function handleDelete(id) {\n    deleteProduct({\n      id: id\n    });\n  };\n\n  var handleCreatePost = function handleCreatePost() {\n    setEdit({\n      active: true,\n      status: 'create'\n    });\n    setWaiting(false);\n    setForm(initialForm);\n  };\n\n  var updateForm = function updateForm(element) {\n    var newFormdata = update(element, form.formdata, 'posts');\n    setForm(_objectSpread(_objectSpread({}, form), {}, {\n      formError: false,\n      formdata: newFormdata\n    }));\n  };\n\n  var submitForm = function submitForm(e) {\n    e.preventDefault();\n    var dataToSubmit = generateData(form.formdata, 'posts');\n    var formIsValid = isFormValid(form.formdata, 'posts');\n\n    if (formIsValid) {\n      setWaiting(true);\n\n      if (edit.active && edit.status === 'create') {\n        createProduct(dataToSubmit);\n      } else {\n        console.log(dataToSubmit);\n        updateProduct(_objectSpread(_objectSpread({}, dataToSubmit), {}, {\n          id: edit.status\n        }));\n      }\n    } else {\n      setForm(_objectSpread(_objectSpread({}, form), {}, {\n        formError: true,\n        formMessage: 'Kiểm tra lại thông tin'\n      }));\n    }\n  };\n\n  var exitForm = function exitForm(e) {\n    e.preventDefault();\n    setEdit({\n      active: false,\n      status: 'none'\n    });\n    setWaiting(false);\n  };\n\n  useEffect(function () {\n    getProductsByAdmin();\n  }, []);\n  useEffect(function () {\n    if (getProductsError) {\n      message.error(getProductsError);\n    }\n  }, [getProductsError]);\n  useEffect(function () {\n    if (deleteProductError) {\n      message.error(deleteProductError);\n    }\n  }, [deleteProductError]);\n  useEffect(function () {\n    if (updatePublishError) {\n      message.error(updatePublishError);\n    }\n  }, [updatePublishError]);\n  useEffect(function () {\n    if (updateAvailableError) {\n      message.error(updateAvailableError);\n    }\n  }, [updateAvailableError]);\n  useEffect(function () {\n    if (updateProductError) {\n      message.error(updateProductError);\n    }\n  }, [updateProductError]);\n  useEffect(function () {\n    if (createProductError) {\n      setWaiting(false);\n      setForm(_objectSpread(_objectSpread({}, form), {}, {\n        formdata: _objectSpread(_objectSpread({}, form.formdata), {}, {\n          name: _objectSpread(_objectSpread({}, form.formdata.name), {}, {\n            valid: false,\n            validationMessage: 'Tên sản phẩm đã tồn tại'\n          })\n        })\n      }));\n    }\n  }, [createProductError]);\n  useEffect(function () {\n    if (products) {\n      setLoading(false);\n      setWaiting(false);\n      setEdit({\n        active: false,\n        status: 'none'\n      });\n    }\n  }, [products]);\n\n  if (loading) {\n    return __jsx(\"div\", {\n      className: styles.loading\n    }, __jsx(CircularProgress, {\n      size: 50,\n      thickness: 4\n    }));\n  } else if (edit.active) {\n    return __jsx(\"div\", {\n      className: styles.formContainer\n    }, __jsx(\"form\", null, __jsx(\"div\", {\n      className: styles.title,\n      onSubmit: function onSubmit(event) {\n        return submitForm(event);\n      }\n    }, edit.status === 'create' ? 'Thêm sản phẩm' : 'Sửa sản phẩm'), __jsx(FormField, {\n      id: 'name',\n      formdata: form.formdata.name,\n      change: function change(e) {\n        return updateForm(e);\n      }\n    }), __jsx(FormField, {\n      id: 'price',\n      formdata: form.formdata.price,\n      change: function change(e) {\n        return updateForm(e);\n      }\n    }), __jsx(FormField, {\n      id: 'image',\n      formdata: form.formdata.image,\n      change: function change(e) {\n        return updateForm(e);\n      }\n    }), __jsx(FormField, {\n      id: 'salePrice',\n      formdata: form.formdata.salePrice,\n      change: function change(e) {\n        return updateForm(e);\n      }\n    }), form.formError && __jsx(\"div\", {\n      className: styles.errorLabel\n    }, form.formMessage), isWaiting && __jsx(\"div\", {\n      className: styles.waiting\n    }, __jsx(CircularProgress, {\n      color: \"secondary\"\n    })), __jsx(\"div\", {\n      className: styles.buttonWrapper\n    }, __jsx(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      className: styles.button,\n      onClick: function onClick(event) {\n        return exitForm(event);\n      }\n    }, \"H\\u1EE7y\"), __jsx(Button, {\n      variant: \"contained\",\n      color: \"secondary\",\n      className: styles.button,\n      onClick: function onClick(event) {\n        return submitForm(event);\n      },\n      type: \"submit\"\n    }, \"X\\xE1c nh\\u1EADn\"))));\n  } else {\n    return __jsx(\"div\", {\n      className: styles.container\n    }, __jsx(\"div\", {\n      className: styles.topWrapper\n    }, __jsx(TopAdminTable, {\n      handleCreate: handleCreatePost\n    })), __jsx(\"div\", {\n      className: styles.tableWrapper\n    }, __jsx(Table, {\n      columns: columns,\n      dataSource: products,\n      rowKey: function rowKey(record) {\n        return record._id;\n      }\n    })));\n  }\n}\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    products: state.products.productsByAdmin,\n    getProductsError: state.products.getProductsByAdminError,\n    createProductError: state.products.createProductError,\n    deleteProductError: state.products.deleteProductError,\n    updatePublishError: state.products.updatePublishProductError,\n    updateProductError: state.products.updateProductError,\n    updateAvailableError: state.products.updateAvailableProductError\n  };\n};\n\nexport default connect(mapStateToProps, {\n  getProductsByAdmin: getProductsByAdmin,\n  createProduct: createProduct,\n  deleteProduct: deleteProduct,\n  updatePublish: updatePublish,\n  updateProduct: updateProduct,\n  updateAvailable: updateAvailable\n})(AdminProducts);","map":null,"metadata":{},"sourceType":"module"}